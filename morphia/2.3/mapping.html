<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Morphia Docs</title>
    <meta name="generator" content="Antora 3.1.4">
<link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="../../_/css/morphia.css">

  </head>
  <body class="article">
<header class="header" role="banner">
    <nav class="navbar">
        <div class="navbar-brand">
            <img height="80%" src="../../_/img/logo.png">
        </div>
        <div class="navbar-brand">
            <div class="navbar-item">
                <a href="https://morphia.dev">Morphia</a>
                <span class="separator">//</span>
                <a href="../..">Docs</a>
            </div>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item has-dropdown is-hoverable">
                    <div class="navbar-link">Projects</div>
                    <div class="navbar-dropdown">
                        <div class="navbar-item"><strong>Core</strong></div>
                        <a class="navbar-item" href="https://github.com/MorphiaOrg/morphia">Repository</a>
                        <a class="navbar-item" href="https://github.com/MorphiaOrg/morphia/issues">Issue Tracker</a>
                        <hr class="navbar-divider">
                        <div class="navbar-item"><strong>Critter</strong></div>
                        <a class="navbar-item" href="https://github.com/MorphiaOrg/critter">Repository</a>
                        <a class="navbar-item" href="https://github.com/MorphiaOrg/critter/issues">Issue Tracker</a>
                        <!--                        <hr class="navbar-divider">-->
                        <!--                        <a class="navbar-item" href="https://github.com/MorphiaOrg/morphia/blob/master/contributing.adoc">Contributing</a></div>-->
                    </div>
                </div>

                <div class="navbar-item has-dropdown is-hoverable">
                    <div class="navbar-link">Community</div>
                    <div class="navbar-dropdown is-right">
                        <a class="navbar-item" href="https://developer.mongodb.com/community/forums/c/drivers-odms/">Drivers &
                            ODMs chat</a>
                    </div>
                </div>

                <a class="navbar-item" href="https://twitter.com/evanchooly">
                    <span class="icon">
                        <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path fill="#57aaee"
                                  d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
                        </svg>
                    </span>
                </a>
            </div>
        </div>
    </nav>
</header>

<div class="body">
<div class="nav-container" data-component="morphia" data-version="2.3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Morphia</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migrating.html">Migrating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quicktour.html">Quick Tour</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kotlin.html">Kotlin</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="mapping.html">Mapping</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="indexing.html">Indexing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sharding.html">Sharding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="queries.html">Querying</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="querying-old.html">Querying (Legacy)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="updates.html">Updating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="updating-old.html">Updating (Legacy)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="deletes.html">Deleting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="aggregations.html">Aggregation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="textSearches.html">Text Search</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references.html">References</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lifeCycleMethods.html">Life Cycle Methods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="schemaValidation.html">Schema Validation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><em>Support</em></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="issues-help.html">Issues &amp; Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/MorphiaOrg/morphia/">GitHub Repository</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="javadoc/index.html">Javadoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Morphia</span>
    <span class="version">2.3</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Critter</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../critter/4.4/index.html">4.4</a>
        </li>
        <li class="version">
          <a href="../../critter/4.3/index.html">4.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Home</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../landing/index.html">landing</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Morphia</span>
      <ul class="versions">
        <li class="version">
          <a href="../3.0/index.html">3.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../2.5/index.html">2.5-SNAPSHOT</a>
        </li>
        <li class="version is-latest">
          <a href="../2.4/index.html">2.4</a>
        </li>
        <li class="version is-current">
          <a href="index.html">2.3</a>
        </li>
        <li class="version">
          <a href="../1.6/index.html">1.6</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../landing/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Morphia</a></li>
    <li>Features</li>
    <li><a href="mapping.html">Mapping</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">2.3</button>
  <div class="version-menu">
    <a class="version" href="../3.0/mapping.html">3.0-SNAPSHOT</a>
    <a class="version" href="../2.5/mapping.html">2.5-SNAPSHOT</a>
    <a class="version" href="../2.4/mapping.html">2.4</a>
    <a class="version is-current" href="mapping.html">2.3</a>
    <a class="version is-missing" href="../1.6/index.html">1.6</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/MorphiaOrg/morphia/edit/2.3.x/docs/modules/ROOT/pages/mapping.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_mapping"><a class="anchor" href="#_mapping"></a>Mapping</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_classes"><a class="anchor" href="#_classes"></a>Classes</h3>
<div class="paragraph">
<p>Mapping is triggered by annotating your type with the <a href="javadoc/dev/morphia/annotations/Entity.html">@Entity</a> annotation.This
instructs Morphia to inspect your type compute various metadata items about it.If you wish use a particular type as "top level" type,
you will need to annotate one field with the <a href="javadoc/dev/morphia/annotations/Id.html">@Id</a> annotation.Not every type will need to
serve as a top level type (read: be mapped to a collection) and so this ID field is optional with the caveat mentioned in the call out
note below.Top level types have their own collections whose names can be mapped via the <code>value</code> parameter.Leaving this value
blank will leave Morphia free to compute the collection name as defined by the collection naming strategy defined in
<a href="javadoc/dev/morphia/mapping/MapperOptions.html">MapperOptions</a>.That default is currently the camel case value of the class&#8217;s
simple name.For example, to map a <code>UserProfile</code> entity under this strategy, the collection name would be mapped to <code>userProfile</code>.</p>
</div>
<div class="paragraph">
<p>Any type annotated with <a href="javadoc/dev/morphia/annotations/Entity.html">@Entity</a> may optionally have a field annotated with
<a href="javadoc/dev/morphia/annotations/Id.html">@Id</a>.The type of the field can be any type so long as Morphia, or the driver, has a codec
that can map the data to and from mongodb.When mapping an entity, one can also define <a href="indexing.html" class="xref page">indexes</a> and
<a href="schemaValidation.html" class="xref page">schema validations</a> as part of the entity declaration as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of 2.2, <a href="javadoc/dev/morphia/annotations/Embedded.html">@Embedded</a> has been deprecated in favor of
<a href="javadoc/dev/morphia/annotations/Entity.html">@Entity</a>.  The distinction between the two annotations has been, historically, much
more significant than it is at present.  Due to the confusion about when to use which annotation and the meaning of "embedded" in
general, it is being decommissioned.  The two annotations have grown to mean essentially the same thing and so have become increasingly
redundant.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Entities annotated with <a href="javadoc/dev/morphia/annotations/Entity.html">@Entity</a> that lack an
<a href="javadoc/dev/morphia/annotations/Id.html">@Id</a> are not eligible to serve as "top level" types.  This means they will not be mapped to
a collection nor can they serve as the basis for querying or be saved directly (only as fields on top level types).  ID fields are used to
perform proper updates on previously persisted entities.  Without that ID Morphia, can not properly restrict the update to the correct
document in the database.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_constructors"><a class="anchor" href="#_constructors"></a>Constructors</h4>
<div class="paragraph">
<p>Morphia has traditionally required a 0-argument constructor on any mapped entity.
In fact, Morphia still prefers to use such a constructor should one be available.
However, as of 2.1, Morphia can also make use of another constructor that meets certain criteria:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The number of arguments in the constructor must match the number of fields on the class.
That is, every field must be represented in the constructor signature.</p>
</li>
<li>
<p>The names of the arguments must match the names of the fields.
Here, there is a bit of flexibility.
The argument name can match either the field name as found in the source or the mapped name as determined by any <code>@Property</code> annotation.
While this is likely to be the most common case as it is the simplest, for various this won&#8217;t always be possible or preferable.
If a constructor argument name can&#8217;t mirror the field name, using the <a href="javadoc/dev/morphia/annotations/Name.html">@Name</a> annotation, an explict name can be given so that the argument can be properly matched to a field.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changing the mapping configuration can interfere with Morphia&#8217;s ability to map arguments and fields so be careful when making changes to such things as the default field naming strategy or <a href="javadoc/dev/morphia/annotations/Property.html">@Property</a> definitions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this mapping to take place, the source must be compiled to include the parameters in the generated bytecode.
With <code>javac</code> this is typically already configured by default.
However, Kotlin users will likely need to configure their builds to include the appropriate option.
For maven users, it&#8217;s as simple as adding one line to the Kotlin maven plugin <code>&lt;configuration&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;javaParameters&gt;true&lt;/javaParameters&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_external_types"><a class="anchor" href="#_external_types"></a>External types</h3>
<div class="paragraph">
<p>Sometimes persisted types come from external libraries whose source is either unavailable or simply can&#8217;t be modified.
Using these types would be impossible give then annotation requirements as stated above.
Morphia 2.3 introduces a new experimental API that loosens these restrictions a bit.
Using <a href="javadoc/dev/morphia/annotations/ExternalEntity.html">@ExternalEntity</a> these external types can be mapped using a proxy type.</p>
</div>
<div class="paragraph">
<p>Consider the following two types.
This first type is an external entity which, for whatever reason, can not be annotated with Morphia&#8217;s annotations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ThirdPartyEntity {
    public String field;
    public Long number;

    // other methods

    @Override
    public int hashCode() {
        // ...
    }

    @Override
    public boolean equals(Object o) {
       // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class could contain any amount of other code but what we&#8217;re interested in is mapping those two fields.
To accomplish this, we define a mix-in type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ExternalEntity(value = "extEnt",
    discriminator = "ext",
    discriminatorKey = "_xt",
    concern = "JOURNALED",
    cap = @CappedAt(count = 123, value = 456),
    target = ThirdPartyEntity.class)
public class ThirdPartyEntityMixIn {
    public String field;
    @Id
    public Long number;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you&#8217;ll note the use of the new annotation.  <code>ExternalEntity</code> looks just like <a href="javadoc/dev/morphia/annotations/Entity.html">Entity</a>
but has a new field called <code>targetType</code>.
As you can see here, we list the target type as our original <code>ThirdPartyEntity</code>.
But this mix-in type otherwise looks just like the external type we&#8217;re trying to map.
Annotations can be applied to the fields and methods on the mix-in types and those values will be applied to the mapping data as normal.
Using this approach, we can define alternate names for fields and map collection names, etc., as if we owned the original type all without touching it.
As with all top level entities, if you want to store this type in its own collection, you&#8217;ll need to mark a field as the ID field.
But once this mapping is done, you can then query against the original type just as you would any other Morphia entity.
The mix-in type can happily be ignored once you&#8217;re done with mapping.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This API is experimental and is likely to shift a bit as it sees usage and feedback from the community.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_versioning"><a class="anchor" href="#_versioning"></a>Versioning</h3>
<div class="paragraph">
<p>Entities can be versioned to ensure that changes are applied serially and that no other processes are modifying an object in between the time it&#8217;s fetched, modified, and written back to the database.
To achieve this, simply add a field to a type, it can be a <code>long</code> or a
<code>Long</code>, and annotate that field with  <a href="javadoc/dev/morphia/annotations/Version.html">@Version</a>.
Morphia will take care of the rest.
If an object is fetched and another process updates the corresponding document in the database before it can be persisted back, an exception will be thrown when the write is attempted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This field must not be initialized to anything other than zero or null or the ID field must be null.
Morphia checks the value of the version field or that the ID is null in order properly save the first version.
If neither of these conditions are true, the entity will not be persisted.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_fields"><a class="anchor" href="#_fields"></a>Fields</h3>
<div class="paragraph">
<p>By default, any non-static field on a mapped class will be processed for persistence.
If a field is to be excluded from the mapping, it can be decorated with the <code>transient</code> keyword, annotated with
<a href="javadoc/dev/morphia/annotations/Transient.html">@Transient</a>, or with the <code>java.beans.Transient</code> annotation.
Otherwise all fields will be included that are defined on the mapped class and any super type.
However, Morphia will ignore fields in any super types found in <code>java*</code> packages which includes the standard JDK classes and the Java EE APIs.</p>
</div>
<div class="paragraph">
<p>There are times when it is necessary to modify a field mapping&#8217;s name, e.g. Using the
<a href="javadoc/dev/morphia/annotations/Property.html">@Property</a> annotation, a new name can be defined that will be used when writing to and reading from the database.
During a schema evolution, it is possible to load a field from an old name as well using the
<a href="javadoc/dev/morphia/annotations/AlsoLoad.html">@AlsoLoad</a> annotation.
Using this annotation, multiple old names can be used to find a field&#8217;s value in a returned document from query.
However, only the field&#8217;s name or the value specified in the <code>@Property</code> annotation will be used when writing documents back to the database.
Similarly, if data is only intended to be loaded from the database but never written back, that field can be annotated with <a href="javadoc/dev/morphia/annotations/LoadOnly.html">@LoadOnly</a></p>
</div>
<div class="paragraph">
<p>If you do not specify a name via <code>@Property</code>, the default field naming strategy will be used.
The default strategy is to use the field&#8217;s name as defined in the source.
This strategy can be changed globally via the field naming strategy option on
<a href="javadoc/dev/morphia/mapping/MapperOptions.html">MapperOptions</a>.
Simple indexes can be defined on a field if all that is needed for the index is a single field.
This can be done via the <a href="javadoc/dev/morphia/annotations/Indexed.html">@Indexed</a> annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_methods"><a class="anchor" href="#_methods"></a>Methods</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Method-based mapping is new in 2.2. While testing has been done to ensure everything works the same as with fields, there may some esoteric combinations of features that reveal a gap in functionality.
Please file an <a href="https://github.com/MorphiaOrg/morphia/issues">issue</a>
if you encounter such a case.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As of 2.2, mapping information can be defined on methods instead of fields.
All the same rules apply, simply the location of the annotations are moved to the getters and/or setters.Annotations can live on either the <code>get</code> or the <code>set</code> method and Morphia will detect them.
If the same annotation is applied to both the <code>get</code> and the <code>set</code> behavior is unpredictable so care should be taken to avoid such a scenario.
Customs in other libraries tend to favor annotating the <code>get</code> methods and this is also recommended here for consistency.</p>
</div>
<div class="paragraph">
<p>In order for methods to be considered as definitions of persistable properties, the Java Bean Spec largely applies here.
This has some very basic rules for your methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>get</code> methods take no parameters</p>
</li>
<li>
<p><code>set</code> methods take one parameter and the type of that parameter should generally match the return type of the getter.These setter methods also return void.</p>
</li>
<li>
<p>If a property is a boolean type, the getter often uses <code>is</code> rather than <code>get</code> yielding a method named, e.g., <code>isEnabled()</code> rather than
<code>getEnabled()</code>.</p>
</li>
<li>
<p>The type of the property is determined by the return value of the getter.</p>
</li>
<li>
<p>The name of the property is determined by stripping the <code>get</code> prefix (or <code>is</code> for boolean types) and lower casing the first letter.
This is the default name of the property subject to property naming rules as defined in
<a href="javadoc/dev/morphia/mapping/MapperOptions.html">MapperOptions</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To enable method mapping, a method has been added to <a href="javadoc/dev/morphia/mapping/MapperOptions.Builder.html">MapperOptions.Builder</a>
allowing for the configuration of either field or method mapping.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Mapping is currently done via either fields or by methods.It is not currently allowed to map using both schemes simultaneously.This will
likely change in the future but for now is not allowed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<!--
<footer class="footer">
    <p>Copyright (C) 2020-2025
</footer>
-->
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
