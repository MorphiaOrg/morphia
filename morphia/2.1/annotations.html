<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Annotations :: Morphia Docs</title>
    <meta name="generator" content="Antora 2.3.3">
<link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="../../_/css/morphia.css">

  </head>
  <body class="article">
<header class="header" role="banner">
    <nav class="navbar">
        <div class="navbar-brand">
            <img height="80%" src="../../_/img/logo.png">
        </div>
        <div class="navbar-brand">
            <div class="navbar-item">
                <a href="https://morphia.dev">Morphia</a>
                <span class="separator">//</span>
                <a href="../..">Docs</a>
            </div>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item has-dropdown is-hoverable">
                    <div class="navbar-link">Projects</div>
                    <div class="navbar-dropdown">
                        <div class="navbar-item"><strong>Core</strong></div>
                        <a class="navbar-item" href="https://github.com/MorphiaOrg/morphia">Repository</a>
                        <a class="navbar-item" href="https://github.com/MorphiaOrg/morphia/issues">Issue Tracker</a>
                        <hr class="navbar-divider">
                        <div class="navbar-item"><strong>Critter</strong></div>
                        <a class="navbar-item" href="https://github.com/MorphiaOrg/critter">Repository</a>
                        <a class="navbar-item" href="https://github.com/MorphiaOrg/critter/issues">Issue Tracker</a>
                        <!--                        <hr class="navbar-divider">-->
                        <!--                        <a class="navbar-item" href="https://github.com/MorphiaOrg/morphia/blob/master/contributing.adoc">Contributing</a></div>-->
                    </div>
                </div>

                <div class="navbar-item has-dropdown is-hoverable">
                    <div class="navbar-link">Community</div>
                    <div class="navbar-dropdown is-right">
                        <a class="navbar-item" href="https://developer.mongodb.com/community/forums/c/drivers-odms/">Drivers &
                            ODMs chat</a>
                    </div>
                </div>

                <a class="navbar-item" href="https://twitter.com/evanchooly">
                    <span class="icon">
                        <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path fill="#57aaee"
                                  d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
                        </svg>
                    </span>
                </a>
            </div>
        </div>
    </nav>
</header>

<div class="body">
<div class="nav-container" data-component="morphia" data-version="2.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Morphia</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quick-tour.html">Quick Tour</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="mapping.html">Mapping</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="querying.html">Querying</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="querying-old.html">Querying (Legacy)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="textSearch.html">Text Search</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="updating.html">Updating</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="updating-old.html">Updating (Legacy)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="aggregation.html">Aggregation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="transactions.html">Transactions</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="annotations.html">Annotations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="indexing.html">Indexing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lifeCycleMethods.html">Life Cycle Methods</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="issues-help.html">Issues &amp; Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="javadoc/index.html">Javadoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Morphia</span>
    <span class="version">2.1</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Critter</span>
      <ul class="versions">
        <li class="version">
          <a href="../../critter/4.2/index.html">4.2-SNAPSHOT</a>
        </li>
        <li class="version is-latest">
          <a href="../../critter/4.1/index.html">4.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Home</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../landing/index.html">landing</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Morphia</span>
      <ul class="versions">
        <li class="version">
          <a href="../2.3/index.html">2.3-SNAPSHOT</a>
        </li>
        <li class="version is-latest">
          <a href="../2.2/index.html">2.2</a>
        </li>
        <li class="version is-current">
          <a href="index.html">2.1</a>
        </li>
        <li class="version">
          <a href="../2.0/index.html">2.0</a>
        </li>
        <li class="version">
          <a href="../1.6/index.html">1.6</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../landing/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Morphia</a></li>
    <li><a href="annotations.html">Annotations</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">2.1</button>
  <div class="version-menu">
    <a class="version is-missing" href="../2.3/index.html">2.3-SNAPSHOT</a>
    <a class="version is-missing" href="../2.2/index.html">2.2</a>
    <a class="version is-current" href="annotations.html">2.1</a>
    <a class="version" href="../2.0/annotations.html">2.0</a>
    <a class="version" href="../1.6/annotations.html">1.6</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/MorphiaOrg/morphia/edit/2.1.x/docs/modules/ROOT/pages/annotations.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Annotations</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Below is a list of all the annotations and a brief description of how to use them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_indexes"><a class="anchor" href="#_indexes"></a>Indexes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Indexes can be defined on each field directly for single field indexing or at the class level for compund indexes.
To see the next few annotations in context, please refer to
<a href="https://github.com/MorphiaOrg/morphia/blob/2.1.x/morphia/src/test/java/dev/morphia/TestIndexCollections.java">TestIndexCollections.java</a> or
<a href="https://github.com/MorphiaOrg/morphia/blob/2.1.x/morphia/src/test/java/dev/morphia/indexes/TestIndexed.java">TestIndexed.java</a> in the Morphia source.</p>
</div>
<div class="sect2">
<h3 id="_index"><a class="anchor" href="#_index"></a>Index</h3>
<div class="paragraph">
<p>The <a href="javadoc/dev/morphia/annotations/Index.html" class="page">@Index</a> documentation can be found
<a href="javadoc/dev/morphia/annotations/Index.html" class="page">here</a>.
There are two pieces to this annotation that are mutually exclusive.
The first group of parameters are considered legacy.
They are safe to use but will be removed in the 2.x series.
These options and more have been conglomerated in the
<a href="javadoc/dev/morphia/annotations/IndexOptions.html" class="page">@IndexOptions</a> annotation.</p>
</div>
<div class="sect3">
<h4 id="_field"><a class="anchor" href="#_field"></a>Field</h4>
<div class="paragraph">
<p>The <a href="javadoc/dev/morphia/annotations/Field.html" class="page">@Field</a> annotation defines indexing on a specific document field.
Multiple instances of this annotation may be passed to the <a href="javadoc/dev/morphia/annotations/Index.html" class="page">@Index</a> annotation to define a compound index on multiple fields.</p>
</div>
</div>
<div class="sect3">
<h4 id="_indexoptions"><a class="anchor" href="#_indexoptions"></a>IndexOptions</h4>
<div class="paragraph">
<p>The <a href="javadoc/dev/morphia/annotations/IndexOptions.html" class="page">@IndexOptions</a> annotation defines the options to apply to an index definition.
This annotation replaces the fields found directly on the <a href="javadoc/dev/morphia/annotations/Index.html" class="page">@Index</a> annotation.
This annotation was added to ensure that index options are consistent across the various index definition approaches.</p>
</div>
</div>
<div class="sect3">
<h4 id="_collation"><a class="anchor" href="#_collation"></a>Collation</h4>
<div class="paragraph">
<p>The <a href="javadoc/dev/morphia/annotations/Collation.html" class="page">@Collation</a> annotation defines the
<a href="http://docs.mongodb.org/manual/reference/collation/">collation</a> options to apply to the index definition.
In addition to defining a collation as part of an index, a collation can be specified as part of a query as well.
The Options classes provide facilities for specifying a specific collation to be used for any given operation.
This collation does not have to match the one defined on the index but will, of course, be faster if it does.
See <a href="#javadoc:dev/morphia/CountOptions.html" class="page unresolved">CountOptions</a>,
<a href="javadoc/dev/morphia/DeleteOptions.html" class="page">DeleteOptions</a>,
<a href="#javadoc:dev/morphia/FindOptions.html" class="page unresolved">FindOptions</a>,
<a href="#javadoc:dev/morphia/MapReduceOptions.html" class="page unresolved">MapReduceOptions</a>, and <a href="javadoc/dev/morphia/FindAndModifyOptions.html" class="page">FindAndModifyOptions</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_indexed"><a class="anchor" href="#_indexed"></a>Indexed</h4>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/Indexed.html" class="page">@Indexed</a>, applied to a Java field, marks the field to be indexed by MongoDB.
This is used for simple, single-field indexes.
As stated above, the <code>options</code> value replaces the individual setting values on the
<code>@Indexed</code> annotation itself.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_entity_mapping"><a class="anchor" href="#_entity_mapping"></a>Entity Mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Morphia provides a number of annotations providing for the customization of object mapping.</p>
</div>
<div class="sect2">
<h3 id="_entity"><a class="anchor" href="#_entity"></a>Entity</h3>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/Entity.html" class="page">@Entity</a> marks entities to be stored directly in a collection.
This annotation is optional in most cases but is required if an entity is to be mapped to a specifically named collection.
If no mapping is given, the collection is named after the class itself.
There are two different mechanisms for mapping cross-object relationships in Morphia:
references and embedding.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reference"><a class="anchor" href="#_reference"></a>Reference</h3>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/Reference.html" class="page">@Reference</a> marks a field as a reference to a document stored in another collection and is linked (by a <code>DBRef</code> field).
When the Entity is loaded, the referenced entity is also be loaded.
Any object referenced via an <code>@Reference</code> field must have already have a non-null <a href="javadoc/dev/morphia/annotations/Id.html" class="page">@Id</a> value in the referenced entity.
This can be done by either saving the referenced entities first or by manually assigning them ID values.
By default, these referenced entities are automatically loaded by Morphia along with the referencing entity.
This can result in a high number of database round trips just to load a single entity.
To resolve this, <code>lazy = true</code> can be passed to the annotation.
This will create a dynamic proxy which will lazily load the entity the first time it is referenced in code.</p>
</div>
<div class="paragraph">
<p>Fields annotated with <code>@Reference</code> will show up in MongoDB as <code>DBRef</code> fields by default.
A <code>DBRef</code> stores not only the entity&#8217;s ID value but also the collection name.
In most cases, this is probably redundant information as the collection name is already encoded in the entity&#8217;s mapping information.
To reduce the amount of storage necessary to track these references, use <code>idOnly = true</code> in the mapping.
This will result in only the ID value being stored in the document.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Morphia 1.5.0 introduced a new experimental API help with some of the complications involved with the annotation based mapping.
As this is an experimental API, details may change and the entire API might be removed.
But users are encouraged to experiment with the API and provide any feedback via GitHub Issues.
Further documentation can be found <a href="references.html" class="page">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_embedded"><a class="anchor" href="#_embedded"></a>Embedded</h3>
<div class="paragraph">
<p>In contrast to <code>@Reference</code> where a nested Java reference ends up as a separate document in a collection,
<a href="javadoc/dev/morphia/annotations/Embedded.html" class="page">@Embedded</a> tells Morphia to embed the document created from the Java object in the document of the parent object.
This annotation can be applied to the class of the embedded type or on the field holding the embedded instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_validation"><a class="anchor" href="#_validation"></a>Validation</h3>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/Validation.html" class="page">@Validation</a> allows for the definition of a
<a href="http://docs.mongodb.org/manual/core/document-validation/">document validation</a> schema to applied to all writes to MongoDB. Validation rules are specified on a per-collection basis using any query operators, with the exception of <code>$near</code>, <code>$nearSphere</code>, <code>$text</code>, and <code>$where</code>.
This validation definition is done using the MongoDB query syntax as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Validation("{ number : { $gt : 10 } }")
public class SomeEntity {
    private int number;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Various operations on <a href="javadoc/dev/morphia/Datastore.html" class="page">Datastore</a> and
<a href="javadoc/dev/morphia/AdvancedDatastore.html" class="page">AdvancedDatastore</a> can bypass this validation via their Options classes.
For these operations, specify the <code>bypassDocumentValidation</code> option to disable document validation for a specific operation.
See
<a href="javadoc/dev/morphia/InsertOptions.html" class="page">InsertOptions</a>,
<a href="javadoc/dev/morphia/UpdateOptions.html" class="page">UpdateOptions</a>,
<a href="#javadoc:dev/morphia/MapReduceOptions.html" class="page unresolved">MapReduceOptions</a>, and <a href="javadoc/dev/morphia/FindAndModifyOptions.html" class="page">FindAndModifyOptions</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_id"><a class="anchor" href="#_id"></a>Id</h3>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/Id.html" class="page">@Id</a> marks a field in an entity to be the <code>_id</code> field in MongoDB. This annotation is required on all top level entities regardless of the presence of an <a href="javadoc/dev/morphia/annotations/Entity.html" class="page">@Entity</a>
annotation.
If a class is marked with <a href="javadoc/dev/morphia/annotations/Embedded.html" class="page">@Embedded</a> this annotation is not required since embedded documents are not required to have <code>_id</code> fields.</p>
</div>
</div>
<div class="sect2">
<h3 id="_property"><a class="anchor" href="#_property"></a>Property</h3>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/Property.html" class="page">@Property</a> is an optional annotation instructing Morphia to persist the field using the given name in the document saved in MongoDB. By default, the field name is used as the property name.
This can be overridden by passing a String with the new name to the annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transient"><a class="anchor" href="#_transient"></a>Transient</h3>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/Transient.html" class="page">@Transient</a> instructs Morphia to ignore this field when converting an entity to a document.
The Java keyword <code>transient</code> can also be used instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serialized"><a class="anchor" href="#_serialized"></a>Serialized</h3>
<div class="paragraph">
<p><a href="#javadoc:dev/morphia/annotations/Serialized.html" class="page unresolved">@Serialized</a> instructs Morphia to serialize this field using JDK serialization.
The field&#8217;s value gets converted to a <code>byte[]</code> and passed to MongoDB.</p>
</div>
</div>
<div class="sect2">
<h3 id="_notsaved"><a class="anchor" href="#_notsaved"></a>NotSaved</h3>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/NotSaved.html" class="page">@NotSaved</a> instructs Morphia to ignore this field when saving but will still be loaded from the database when the entity is read.</p>
</div>
</div>
<div class="sect2">
<h3 id="_alsoload"><a class="anchor" href="#_alsoload"></a>AlsoLoad</h3>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/AlsoLoad.html" class="page">@AlsoLoad</a> instructs Morphia to look for a field under different names than the mapped name.
When a field gets remapped to a new name, you can either update the database and migrate all the fields at once or use this annotation to tell Morphia what older names to try if the current one fails.
It is an error to have values under both the old and new key names when loading a document.
These alternate names are not used in queries, however, so if there are queries against this field they should be updated to use the alternate names as well or the database should be updated such that every instance of the old name is renamed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_version"><a class="anchor" href="#_version"></a>Version</h3>
<div class="paragraph">
<p><a href="javadoc/dev/morphia/annotations/Version.html" class="page">@Version</a> marks a field in an entity to control optimistic locking.
If the versions change in the database while modifying an entity (including deletes) a <code>ConcurrentModificationException</code> will be thrown.
This field will be automatically managed for you&#8201;&#8212;&#8201;there is no need to set a value and you should not do so.
If another name beside the Java field name is desired, a name can be passed to this annotation to change the document&#8217;s field name.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lifecycle_annotations"><a class="anchor" href="#_lifecycle_annotations"></a>Lifecycle Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are various annotations which can be used to register callbacks on certain lifecycle events.
These include Pre/Post-Persist, Pre-Save, and Pre/Post-Load.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@PreLoad</code> - Called before mapping the datastore object to the entity (POJO); the Document is passed as an argument (you can add/remove/change values)</p>
</li>
<li>
<p><code>@PostLoad</code> - Called after mapping to the entity</p>
</li>
<li>
<p><code>@PrePersist</code> - Called before save, it can return a Document in place of an empty one.</p>
</li>
<li>
<p><code>@PreSave</code> - Called before the save call to the datastore</p>
</li>
<li>
<p><code>@PostPersist</code> - Called after the save call to the datastore</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h3>
<div class="paragraph">
<p><a href="https://github.com/MorphiaOrg/morphia/blob/2.1.x/morphia/src/test/java/dev/morphia/TestQuery.java#L63">This</a> is one of the test classes.</p>
</div>
<div class="paragraph">
<p>All parameters and return values are optional in your implemented methods.</p>
</div>
<div class="sect3">
<h4 id="_prepersist"><a class="anchor" href="#_prepersist"></a><code>@PrePersist</code></h4>
<div class="paragraph">
<p>Here is a simple example of an entity that always saves the Date it was last updated at.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class BankAccount {
  @Id String id;
  Date lastUpdated = new Date();

  @PrePersist void prePersist() {lastUpdated = new Date();}
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_entitylisteners"><a class="anchor" href="#_entitylisteners"></a><code>@EntityListeners</code></h4>
<div class="paragraph">
<p>In addition, you can separate the lifecycle event implementation in an external class, or many.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EntityListeners(BackAccountWatcher.class)
public class BankAccount {
  @Id String id;
  Date lastUpdated = new Date();
}

class BankAccountWatcher{

  @PrePersist void prePersist(BankAccount act) {act.lastUpdated = new Date();}

}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<!--
<footer class="footer">
    <p>Copyright (C) 2020-2021
</footer>
-->
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
